---
title   : "A practical primer on transparent research workflows"
subtitle: "Handout"
author  : "Frederik Aust & Dr. Johannes Breuer"

date    : "04.09.2018"
location: "ESCON 2018, Cologne, Germany"

output:
  bookdown::html_document2:
    theme         : "spacelab"
    df_print      : "kable"
    toc           : true
    toc_float     : true
---

```{r setup, include = FALSE}
library("knitr")
library("rmarkdown")

opts_chunk$set(echo = FALSE, fig.align = "center")
```

# TODO

- Set up OSF repository with project structure that participants can fork to create their own project
- TIER template to clone: https://osf.io/ybzxe/
- BIDS example on GitHub: https://github.com/INCF/BIDS-examples

- Prepare OSF demo (see Candice Morey's slides)

- Check https://open-science-training-handbook.gitbook.io/book/examples-and-practical-guidance
- additional resource to mention: [Open Science Knowledge Base](https://how-to-open.science/) by Felix Henninger (et al.)

- Mention OpenSesame, Lab.js, jsPsych

- Worksheet to assamble workflow

- Recommendation symbol


# General considerations

> do not let the perfect be the enemy of the good. Share
and document what you can, as it will provide a benefit
compared with not sharing (p. 4, Klein et al., 2018).

- Make transparency a default
    - Make documentation and sharing a by-product of the lab workflow
        - If possible, share all products of the research process
        - If negative constraints prohibit transparency, explicitly declare and justify these decisions in the manuscript
    - Automate what can be automated

<!-- - Making your workflow play well with the rest of the lab? -->
<!--     - Do not impose -->
<!--     - Compromise surely necessary -->


# What can you share?

- Learn and improve system based on experience with previous projects
- _Amnesia test_ (Could I still understand this if I lost my memory?)

```{r figure1, fig.cap = "Decision flowchart outlining important considerations when sharing research products."}
include_graphics("images/klein-et-al-figure-1.png")
```


## Study protocol

- Recipe for replication
- Collates, describes, and organises more specific research products
    - Hypotheses
    - Study materials
    - Detailed description of procedure
        - Instructive video documentation (e.g., [OBS](https://obsproject.com/) for computer-based studies)

        <!-- - __Demonstration:__ OBS -->
    
<!-- - May be more detailed than published description -->
<!-- - Facilitates scientific progress (e.g., replication and extension) -->


## Study materials

- Anything necessary to conduct the study, e.g.,
    - Questionnaires
    - Stimulus material
    - Computer code to present stimuli and collect responses
    - Instructions for interaction with participants
    - potentially also scripts/instructions for confederates

- Mind intellectual property rights

    <!-- TODO: Anything else? -->
    
<!-- - Aids interpretation of results -->
<!-- - Facilitates scientific progress (e.g., replication and extension) -->


## Data

- Include information about data sharing in informed consent (see [our informed consent templates](http://psych-transparency-guide.uni-koeln.de//informed-consent.html))
- Use open and interoperable file formats (e.g., CSV, TSV, ODS)
    - Use UTF-8 character encoding

<!-- https://twitter.com/dutchscientist/status/898938100008845313 -->

- Raw data
    - As originally recoreded (e.g., paper-pencil-questionaires, CSV files, video recordings)

- Processed data
    - As used for analyses (e.g., coded, digitized, merged)
    - Ideally "Tidy Data" ([Wickham, 2014 ](https://www.jstatsoft.org/index.php/jss/article/view/v059i10/v59i10.pdf))
        1. Each measured variable in one column.
        2. Different observation of the variables in a different rows
        3. Multiple tables should include a column that allows them to be linked
    
    <!-- https://www.tandfonline.com/doi/abs/10.1080/00031305.2017.1375987 -->

- Participant privacy
    - EU GDPR: Data are personal if attributable to a specific person (using additional datasets if necessary)
        - [IAPP: How GDPR changes the rules for research](https://iapp.org/news/a/how-gdpr-changes-the-rules-for-research/)
    - Collect only data you need
    - Delete indentying information used for logistics as soon as possible
    - Only share anonymized data publicly, e.g.,
        - Delete directly identifying information (e.g., full name, address, face, handwriting, date of birth, genetic information)
            - Mind combinations of indirect identifiers (e.g., ZIP code, gender, and date of birth, [Sweeney, 2000](https://dataprivacylab.org/projects/identifiability/paper1.pdf))
        - Separate demographics used for sample description and study data
        - Remove free text entries and potentially also alter them when citing in publications
        - If necessary, transform data, e.g.,
            - Binning
            - Top and bottom coding
            - Add noise
            - Aggregation
        - Use anonymization tools, such as [Amnesia](https://amnesia.openaire.eu/index.html)
    - Control access to pseudonomyzed data 
    
    <!-- - Harm assessment? -->
    
    - Assess risk of reidentification, e.g.,
        - Small population and rare traits
        - Dyadic data
        - Hierarchical data (e.g., small subsamples of students, co-workers)
        - Self-identification??? <!-- TODO: How is this a problem/How would it be possible to prevent this? -->
        - _Motivated intruder test_ (e.g., jealous partner, nosy neighbor, envious co-worker, insurers, criminals)
    <!-- - Who will the data be shared with? -->

> To determine whether a natural person is identifiable, account should be taken of all the means reasonably likely to be used, such as singling out, either by the controller or by another person to identify the natural person directly or indirectly.
<br /><br />
To ascertain whether means are reasonably likely to be used to identify the natural person, account should be taken of all objective factors, such as the costs of and the amount of time required for identification, taking into consideration the available technology at the time of the processing and technological developments. (Recital 26 EU GDPR)


## Metadata

- Sampling procedure (who collected the data how, when, and where)
- Dataset, e.g.,
    - Number of observations
    - Name and description of variables (including for example source of a measure, information about translation)
    - Units of measurement, coding of values (e.g., "1 = Female","2 = Male"), possible options or range in which the data points can fall (e.g., “1 = not at all to 7 = Very much”)
    - Value(s) used for missing data
    - If necessary, how a variable was derived from other variables (e.g., "`bmi` was derived from body weight `m` and height `l` as $\mathrm{BMI} = \frac{m}{l^2}$.")
- Automate codebook generation
    - Analysis software (e.g., [R `codebook` package](https://cran.r-project.org/web/packages/codebook/index.html), [SPSS codebook function](https://libguides.library.kent.edu/SPSS/Codebooks), or [Stata codebook function](http://www.stata.com/manuals13/dcodebook.pdf))
    - Specialized software (e.g., [Nesstar](http://www.nesstar.com/software/publisher.html), [DataWiz](https://datawiz.leibniz-psychology.org/DataWiz/?datawiz_locale=en))
- If data are complex and have potentially high reuse value, consider using a standardized and machine-readable format
    - Implementation is a service provided by some repositories
    <!-- This documentation should describe the variables in each data file in both human- and machine-readable formats (e.g., csv, rather than docx or pdf).4 Ideally, codebooks are organized in such a way that each line represents one variable and each information relative to a variable represents a column. -->
- Can almost always be shared, even if raw or processed data cannot


## Standard operating procedures

- Describe default practices ([Lin & Green, 2016](
https://doi.org/10.1017/S1049096516000810))
- Planning studies, e.g.,
    - Sample size determination
- Data analysis, e.g.,
    - Statistical models
        - Assumption tests
        - Follow-up tests
    - Exclusion criteria
    - Outlier and dropout treatment
    - Treatment of missing values
    - Use of covariates
    - Correction for multiple comparisons
- Example: [SOP for Green lab at Columbia](http://alexandercoppock.com/Green-Lab-SOP/Green_Lab_SOP.pdf)

<!-- - Simplifies authoring of preregistrations -->

<!-- https://doi.org/10.1017/S1049096516000810) -->

<!-- - **Demonstration**: Show examples (https://osf.io/rv7py/, https://osf.io/e4tqy/), show `codebook` package and [SPSS codebook function](https://libguides.library.kent.edu/SPSS/Codebooks) -->
<!-- The author of the codebook (Arslan, 2018) package for R has also created a web app for creating codebooks for SPSS, Stata or RDS files: https://rubenarslan.ocpu.io/codebook/www/ -->


## Documentation of analyses

- Exact specification of how to move from raw data to reported results (incl. data cleaning and transformation)
    - Step-by-step description of analyses performed in non-scriptable software programs
    - Analysis syntax
        - Avoid "works on my machine" errors
            - Relative file paths or load data from a permanent online source
            - Avoid spaces and special characters
            - Test on another computer
    - Set and record seeds for pseudorandom number generators
- Documentation of computational environment 
    - Hardware
    - Software version incl. extensions (e.g., R packages)
    - Cloud-based platforms (e.g., [Code Ocean](https://codeocean.com/), [RStudio cloud](https://rstudio.cloud/), [Colaboratory](https://colab.research.google.com/))
    - Containers and virutal machines (e.g., [Docker](https://www.docker.com/), [Vagrant](https://www.vagrantup.com/))
- Share intermediate results for complex analyses


## Research reports

- Paywalled publications (green open access)
    - Preprint
    - Postprint
    - Mind journal policy (e.g., [SHERPA/RoMEO](http://www.sherpa.ac.uk/romeo/search.php))
- Gold open access
    - Published article



# When can you share?

> any time is better than never  (p. 4, Klein et al., 2018).


## Planning to share

- Develop a default project file structure
- Have a _basic_ data management plan, ideally before starting a project
    - Create basic reusable templates
        - [ICPSR Framework for Creating a Data Management Plan](https://www.icpsr.umich.edu/icpsrweb/content/datamanagement/dmp/framework.html)
        - [DDC: How to Develop a Data Management and Sharing Plan](http://www.dcc.ac.uk/resources/how-guides/develop-data-plan)
    - Use wizards to get started (e.g., [ZPID DataWiz](https://datawiz.leibniz-psychology.org/DataWiz/?datawiz_locale=en), [DMPonline](https://dmponline.dcc.ac.uk/))
    - Simplifies addressing legal and ethical issues
    - Examples: [Public DMPs](https://dmponline.dcc.ac.uk/public_plans)
- Reduces extra sharing efforts

## Before data collection

- Timely archiving
    - Study protocol and materials
    - Standard operating procedures
    - Analysis plan and scripts
- Preregistration


## During data collection

- Born-open data ([Rouder, 2016](https://doi.org/10.3758/s13428-015-0630-z))
    - Automatically uploaded to a public repository
        - Offsite backup
        - Reduces extra sharing efforts
    - Protect participants' privacy!
    - Tutorial: [Born-open data with cloud storage providers](http://psych-transparency-guide.uni-koeln.de/born-open-data.html)

<!-- - **Demonstration**: Set up Dropbox to collect born-open data -->


## Upon submission

- Allows thorough peer-review
    - Errors can be spotted early on (no public correction)
    - Possibly limit access to reviewers prior to publications (e.g., [OSF view-only links](http://help.osf.io/m/links_forks/l/524049-create-a-view-only-link-for-a-project))
- Demonstrates dedication to openness


## Upon publication or after an embargo

- Archive in public respository, publish later
    - Reduces extra sharing efforts

```{r figure2, fig.cap = "Typical workflow indicating when to share research products at different stages of the research process."}
include_graphics("images/klein-et-al-figure-2.png")
```


# How can you share?

## Project structure and naming scheme

- See example project
    - Protocol/Preregistration
    - Materials
    - Raw data
    - Processed data
    - Analysis
    - Research report

- For better access control use components or encrypt (https://medium.com/@richarddmorey/hiding-in-plain-sight-16b275b91625)!

- Exert access control over pseudonomyzed data 
    - Share in access restricted repository
    - Publicly share encrypted data


## Study protocol

- Preregistration
    - **Demonstration**: Show some preregistration websites, showcase good preregistrations (https://osf.io/h9k8n/)
    
- Registered report

- Instructive video footage of procedure
    - Screencapturing computer experiments (e.g., [OBS](https://obsproject.com/))
    - [JoVE Behavior](https://www.jove.com/journal/behavior)

- Time-stamped preregistration ([How to preregister via the OSF](https://osf.io/2vu7m/))
    - [Registered reports](https://cos.io/rr/)


## Study material, data & metadata

- Choose a suitable public repository
    1. Uses persistent and unique identifiers for products (such as DOIs).
    2. Accommodates structured metadata to maximize discoverability and reuse.
    3. Tracks data re-use (e.g., citations, download counts).
    4. Accommodates licensing (e.g., provides the ability to place legal restrictions on data reuse or signal there are no restrictions).
    5. Features access controls (e.g., allows restriction of access to a particular set of users).
    6. Has some persistence guarantees for long-term access.
    7. Stores data in accordance with local legislation (e.g., the new General Data Protection Regulation for the EU, http://www.eugdpr.org/).
    
- Data & metadata
    - Protect participant privacy!
- Public != free to use
- Explicitly apply permissive license
    - Use easy-to-understand standard licenses
        - [Creative Commons](https://creativecommons.org/licenses/)
        - [Open data commons](https://opendatacommons.org/licenses/)
        - Simply include a license statement in a text file ("All files in this repository are licensed under a Creative Commons Zero License (CC0 1.0)")
    - some repositories provide custom licenses for research data
        - [GESIS](https://dbk.gesis.org/DBKSearch/LegendAC.htm)
            - Category 0: Data and documents are released for everybody.
            - Category A: Data and documents are released for academic research and teaching.
            - Category B: Data and documents are released for academic research and teaching, if the results will not be published.
              If any publications or any further work on the results is planned, permission must be obtained by the Data Archive.
            - Category C: Data and documents are only released for academic research and teaching with written authorization of the data                     depositor. For this purpose the Data Archive obtains a written permission with specification of the user and the analysis                      intention.
    - Recommendations
        - Most permissive license possible: e.g., Public domain, CC0 and ODC-PDDL
        - Condition re-use only on attribution, CC-BY and ODC-BY

- for sensitive data, some archives offer special solutions for controlled access (e.g., [GESIS secure data center](https://www.gesis.org/en/services/data-analysis/more-data-to-analyze/secure-data-center-sdc/))
- useful [decision tree](https://www.ands.org.au/__data/assets/pdf_file/0010/385309/sensitive-decision-tree.pdf) from the Australian National Data Service on sharing sensitive data

- Questions for participants: 
    - Which features of a repository would you consider important (for your data)?
    - How would you search for a suitable repository?

<!-- TODO: Tabelle 1 hier unterbringen -->
<!-- TODO: Johannes, sollten wir hier Informationen aus der Tabelle von Meyer, 2018 ergänzen oder ist das redundant? Johannes: da es sonst eher zu viel wird, wuerde ich auf Meyer (2018) eher nur verweisen + re3data database -->

- differences in degree of curation: e.g., OSF (not curated, self-deposit) vs. GESIS DBK (curated, service)
- more detailed description of some social science repositories with a focus on governance attributes can be found in [Meyer, 2018](http://journals.sagepub.com/doi/abs/10.1177/2515245917747656?journalCode=ampa)
- comprehensive database of repositories: [re3data - Registry of Research Data Repositories](https://www.re3data.org/)

    - Hand out DGPs model informed consent
    - Handout table that summarizes repositories
        - Discuss some usecases (maybe suggested by participants)
    - Repository structure
        - **Demonstration**: Browse example OSF repository
    - Citeable datasets
    - FAIR
      - Findable: e.g., public repository > personal website
      - Accessible: only use access restrictions/controls when necessary
      - Interoperable: Use open, lightweight, and interoperable file formats (e.g., CSV, TSV, TXT, ODS)
      - Reusable: Proper documentation


```{r sharing-option-ratings, echo = FALSE}
sharing_options <- data.frame(
  "Sharing option" = c("On request", "Personal website", "Journal website", "Institutional repository", "Public repository")
  , "Discoverability" = c("--", "-", "+", "+", "++")
  , "Sustainability" = c("--", "-", "0", "++", "++")
  , "Access control" = c("++", "0", "0", "+", "+")
  , stringsAsFactors = F
  , check.names = FALSE
)

kable(sharing_options, format = "pandoc", align = "lccc")
```

- bonus: institutional and public repositories (and in many cases also journal websites) make data citeable (usually via DOIs)

<!-- or add "Citeability" to the above table? Citeability <- c("-", "--", "0", "++", "++") -->


## Analysis scripts

- Briefly note some best practices
- **Demonstrate**: Dynamic documents (`papaja`)


- Use open source software

## Reports

- Say something about PsyArXiv vs. BioArXiv vs. PeerJ vs. ...
- PsyArXiv: Official partner of APA (http://www.apa.org/pubs/authors/unauthorized-internet-posting.aspx)
- https://en.wikipedia.org/wiki/List_of_academic_journals_by_preprint_policy (not an exhaustive list)
Only two that explicitly rule out preprints
    - NEJM [New England Journal of Medicine] and JCI [Journal of Clinical Investigation]

(https://nikokriegeskorte.org/2016/03/13/the-selfish-scientists-guide-to-preprint-posting/, https://archaeologicalnetworks.wordpress.com/2017/09/28/open-science-in-archaeology-publication-and-special-interest-group/)
    - upon submission (preprint)
    - upon acceptance (postprint)
        - http://www.sherpa.ac.uk/romeo/search.php

- Green open access
    - preprint repositories, like [PsyArXiv](https://psyarxiv.com/), [BioArXiv](https://www.biorxiv.org/)
    - Usually not considered "prior publication" (Bourne, Polka, Vale, &
Kiley, 2017)
- Gold open access
    - Open publication by publisher


## Licenses

<!-- TODO: Overview of common licenses -->
<!-- Maybe move (some) material from ## Study material, data & metadata section here -->

- licenses define conditions of access and reuse

### Creative Commons Licenses

- Attribution (by): copy, distribute, display, perform and derivate 
work as long as the author or licensor is cited in the manner 
specified
- Non-commercial (nc): copy, distribute, display, perform and 
derivate work as long as the work is used only for non-
commercial purposes
- No Derivative Works (nd): copy, distribute, display, perform but 
no derivative works based on it
- Share-alike (sa): copy, distribute, display, perform and derivate 
work as long as the derivative works is licensed identical to the 
license that governs the original work

- exceptions are possible for all categories if author/licensor gives explicit permission

- examples for potential problems with CC license types for research:
    - ND: researchers add data: cases (e.g., replication study) or variables (e.g., from administrative data)
    - NC: is a publication in a journal or book (that is not open access) commercial? what about research used to develop or improve commercial     products (e.g., in medical research)?
    - SA: what if a researcher adds data and does not want the combined dataset to be used for commercial purposes or if datasets with             different licenses are combined (e.g., CC-BY-SA + CC-BY-NC)?
- hence, you should apply the most permissive license that is possible

<!-- Maybe add images/logos for the categories from https://creativecommons.org/share-your-work/licensing-types-examples/ to the individual bullet points? -->

# How you can promote openness?

## Incentivize sharing

- [PRO initiative](https://opennessinitiative.org/)
- [Commitment to Research Transparency and Open Science](http://www.researchtransparency.org/)
- Practical advantages for researchers (find your own data, more citations...)


## How can you promote research transparency?

- use templates for transparent & reproducible projects
- share materials with your collaborators
- teach your students and colleagues
    - What do we do here in Cologne?
    - Example: Registered Report draft as non-empirical Bachelor's thesis
- vote with you feet
    - Choose journals that value openness/robustness over falshy journals
- Incentives
    - Take openess into account when particpating in commissions (https://osf.io/7jbnt/)
- Give credit where credit is due (cite data, open source software developed by academics, etc.)


## Why not to share?

- Brief discussion of DSGVO? (Anonymisation example?)
- Examples of sensitive data (from participants)
- Scooping
    - Usually an unwarranted fear
    - Publish upon acceptance or with an embargo
- I could be wrong
    - Errors are inevitable
    - Promotes scientific self-correction
    - Errors will become a normal part of science
    - Constructive self-correction will improve scholars' standing (Fetterman & Sassenberg, 2015)
- Time-consuming
    - Take one step at a time ("baby steps")
    - Open science == good research management practices
        - Increases efficency in the long-run
    - Increases exposure and citations
    - Helps to avoid fruitless avenues for future studies


---

> Open Science is just science done right<br /><br />&mdash;Jon Tennant, Imperial College London

---

# Reading

Klein, O., Hardwicke, T. E., Aust, F., Breuer, J., Danielsson, H., Hofelich Mohr, A., … Frank, M. C. (2018). A Practical Guide for Transparency in Psychological Science. _Collabra: Psychology_, 4(1). doi: [10.1525/collabra.158](https://doi.org/10.1525/collabra.158) ([Supplementary material](
http://psych-transparency-guide.uni-koeln.de/))

---
Handout for *`r gsub(".+<br />", "", metadata$title)`: `r gsub(".+<br />", " ", metadata$subtitle)`*, `r metadata$location`, `r metadata$date`.

Frederik Aust ([frederik.aust@uni-koeln.de](mailto:frederik.aust@uni-koeln.de), [\@frederikaust](http://twitter.com/frederikaust)); Dr. Johannes Breuer ([johannes.breuer@gesis.org](mailto:johannes.breuer@gesis.org), [\@MattEagle09](https://twitter.com/MattEagle09))
